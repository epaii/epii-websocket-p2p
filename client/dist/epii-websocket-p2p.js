!function(e,s){"object"==typeof exports&&"object"==typeof module?module.exports=s(require("ws")):"function"==typeof define&&define.amd?define(["ws"],s):"object"==typeof exports?exports.WebSocketP2P=s(require("ws")):e.WebSocketP2P=s(e.ws)}(this,(function(e){return s={629:(e,s,t)=>{let i=[],r=!1;function n(e){i.push(e),r||o()}function o(){if(i.length>0){r=!0;let e=i.shift();setTimeout((()=>{e((()=>{r=!1,o()}))}),10)}}e.exports=class{constructor(e,s,t={}){this.ready_callbacks=[],this.url=e,this.epii_id=s,this.epii_info=t,this.epii_servers={},this.cbs=[],this._start()}_pushcb(e){if(!e)return-1;let s=this.cbs.length;return this.cbs.push(e),s}_start(){this.is_ready=!1,"undefined"==typeof WebSocket?this.ws=new(t(439))(this.url):this.ws=new WebSocket(this.url),this.ws.onclose=()=>{this._start()},this.ws.onopen=()=>{this.send({do:"login",id:this.epii_id,info:this.epii_info}),this.is_ready=!0,this.ready_callbacks.forEach((e=>e()))},this.ws.onmessage=e=>{try{let s=JSON.parse(e.data);s.hasOwnProperty("do")&&this[s.do]&&this[s.do](s)}catch(e){console.log(e)}},this.ws.onerror=e=>{}}regServer(e,s){this.epii_servers[e]=s,this.send({do:"regServer",name:e})}callServer(e,s,t,i){this.send({do:"callServer",id:e,name:s,data:t,cb:this._pushcb(i)})}sendTo(e,s,t,i){this.send({do:"callServer",id:e,name:s,more:1,data:t,cb:this._pushcb(i)})}ping(e,s){this.callServer(e,"__ping",{__ping:1},s)}__callServer(e){this.epii_servers.hasOwnProperty(e.name)&&n((s=>{this.epii_servers[e.name]({data:e.data,client:e.client},(t=>{e.cb-1!=-2&&this.send({do:"reponseCall",connect:e.connect,data:t,cb:e.cb}),s()}))}))}__callback(e){this.cbs.hasOwnProperty(e.cb)&&this.cbs[e.cb](e.data)}send(e){this.ws.send(JSON.stringify(e))}isReady(){return this.is_ready}ready(e){this.is_ready?e():this.ready_callbacks.push(e)}}},439:s=>{"use strict";s.exports=e}},t={},function e(i){if(t[i])return t[i].exports;var r=t[i]={exports:{}};return s[i](r,r.exports,e),r.exports}(629);var s,t}));